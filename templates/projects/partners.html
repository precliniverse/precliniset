{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block head_extra %}
    {{ super() }}
    <style>
        .clickable-row {
            cursor: pointer;
        }

        .clickable-row:hover {
            background-color: #f5f5f5;
        }
    </style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>{{ title }}</h1>
        <a href="{{ url_for('projects.list_projects') }}" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-left me-1"></i>{{ _('Back to Projects List') }}
        </a>
    </div>

    {% if partners_data %}
        <div class="table-responsive">
            <table id="partnersTable" class="table table-striped table-hover table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>{{ _('Company Name') }}</th>
                        <th>{{ _('Contact Email') }}</th>
                        <th class="text-center">{{ _('Active Projects') }}</th>
                        <th class="text-center">{{ _('Total Projects') }}</th>
                        {# Actions column can be added if needed, e.g., for editing partner details #}
                        {# <th>{{ _('Actions') }}</th> #}
                    </tr>
                </thead>
                <tbody>
                    {% for partner_info in partners_data %}
                        <tr class="clickable-row" data-href="{{ url_for('projects.partner_details', partner_id=partner_info.id) }}">
                            <td>{{ partner_info.company_name }}</td>
                            <td>{{ partner_info.contact_email }}</td>
                            <td class="text-center">{{ partner_info.active_projects }}</td>
                            <td class="text-center">{{ partner_info.total_projects }}</td>
                            {# Example Actions Cell:
                            <td>
                                <a href="{{ url_for('some_route_to_edit_partner', partner_id=partner_info.id) }}" class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                            #}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="alert alert-info">{{ _('No partners found or no partners associated with projects you can access.') }}</p>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
{{ super() }} {# Includes jQuery and DataTables JS from base.html #}
<script nonce="{{ csp_nonce }}">
    $(document).ready( function () {
        $('#partnersTable').DataTable({
            "language": { /* ... your translations ... */
                "search": "{{ _('Search:') }}",
                "lengthMenu": "{{ _('Show _MENU_ entries') }}",
                "info": "{{ _('Showing _START_ to _END_ of _TOTAL_ entries') }}",
                "infoEmpty": "{{ _('Showing 0 to 0 of 0 entries') }}",
                "infoFiltered": "{{ _('(filtered from _MAX_ total entries)') }}",
                "paginate": {
                    "first": "{{ _('First') }}",
                    "last": "{{ _('Last') }}",
                    "next": "{{ _('Next') }}",
                    "previous": "{{ _('Previous') }}"
                }
            },
            "order": [[0, "asc"]], // Default sort by Company Name
            "columnDefs": [
                { "className": "text-center", "targets": [2, 3] } // Center align project count columns
                // Add { "orderable": false, "targets": X } if you add an actions column
            ]
        });

        $('#partnersTable').on('click', '.clickable-row', function(event) {
            var href = $(this).data('href');
            if(href) {
                window.location = href;
            }
        });
    } );
</script>
{% endblock %}
